# varspec                                      cmdspec                        #

# Variable- and command specs for baseline suite. +U_s
# Usage:
#   ./sh-main spec Tab Cmd-Glob


# varspec                                      cmdspec                        #

true                                           test -n "$scriptname"
true                                           test -z "$scriptpath"
true                                           test -n "$SCRIPTPATH"
true                                           test -n "$LOG"
true                                           test -z "$INIT_LOG"

set -u
 /SCRIPTPATH                                   test -z "${SCRIPTPATH:-}"

#export SCRIPTPATH=$PWD/src/sh/lib              . ./sh-main
true                                           . ./tool/sh/env.sh
#true                                           . ./tool/ci/env.sh

#export U_S; echo U-s:$U_S                      . ./tool/sh/util.sh
sh_tool=tool/sh ci_tool=tool/ci            . ./tool/sh/util.sh
export sh_tool=tool/sh ci_tool=tool/ci
  . ./tool/sh/util.sh                         . ./tool/ci/util.sh

set -euo pipefail

 . ./tool/sh/env.sh                           echo 1.1. $SCRIPTPATH
 /SCRIPTPATH
  . ./tool/sh/env.sh                          echo 1.2. $SCRIPTPATH

 . ./tool/ci/env.sh                           echo 2.1. $SCRIPTPATH
 /SCRIPTPATH
  . ./tool/ci/env.sh                          echo 2.2. $SCRIPTPATH

 export sh_tool=tool/sh ci_tool=tool/ci
  CWD=$PWD . ./tool/sh/util.sh
   . ./tool/sh/part/env-dev.sh
     sh_include env-log
      sh_include remove-dupes unique-paths
       sh_include env-scriptpath-deps
        sh_include lib-load
         sh_include env-info                   true 3.1.

true                                           ./sh-main lines sh-baseline.tab >/dev/null

set -euo pipefail
  DOCKER_NS=dotmpe                             . ./tool/sh/part/env-docker-hub.sh
  true                                         . ./tool/sh/part/env-dev.sh
  true                                         . ./tool/sh/part/env-0.sh
  true                                         . ./tool/sh/part/env-0-src.sh
  true                                         . ./tool/sh/part/env-std.sh
  true                                         . ./tool/sh/part/env-test.sh
  CWD=$PWD                                     . ./tool/sh/part/env-test-bats.sh

# Test some other parts from sh-main           sh-main: treebox
# XXX: requires docker-sh-htd
#SUITE=Main keep_going=1 stage=
# . ./tool/sh/env.sh
#  sh_include env-scriptpath-deps lib-load
#   . "./commands/u_s-dckr.lib.sh"              docker_image=dotmpe/sandbox:dev dckr_load

true                                           ./.githooks/pre-commit/070-filenames.sh
true                                           ./.githooks/pre-commit/080-whitespace.sh
# varspec                                      cmdspec                        #
#true                                           ./sh-main run-parts build.txt Sh 0
#true                                           ./sh-main run-parts build.txt U-S 0
#true                                           ./sh-main run-parts build.txt Main 0
#true                                           ./sh-main run-parts build.txt Main 0 1
#true                                           ./sh-main run-parts build.txt Test 0
#true                                           ./sh-main run-parts build.txt CI 0 1 2 3 4

# varspec                                      cmdspec                        #

# TODO: wrap in bats cases
v=4
  true                                         ./bin/u-s help >/dev/null
  true                                         ./bin/u-s lib-loaded >/dev/null
  true                                         ./bin/u-s lib-paths >/dev/null
  true                                         ./bin/u-s commands >/dev/null
  true                                         ./bin/u-s topics >/dev/null

# TODO docker-sh-htd.lib
#true                                           ./bin/u-s dckr-cmd . ./sh-treebox-us-req
#true                                           ./bin/u-s dckr update-ext feature/docker-ci 24-2-bare
#dckr_pref="sudo "                              ./bin/u-s dckr-cmd verbosity=7 DEBUG=1 ./bin/u-s version
#v=4
#  dckr_pref="sudo "                            ./bin/u-s dckr-cmd verbosity=0 ./bin/u-s version
#dckr_pref="sudo "                              ./bin/u-s dckr help
#true                                           ./bin/u-s dckr-reset


# varspec                                      cmdspec                        #

set -euo pipefail
 CWD=$PWD;
  . tool/sh/env.sh                            . ./tool/sh/init.sh

# ./bin/u-s update
#   f_lib_load= util_mode= default_lib=         . ./tool/sh/init-wrapper.sh
#    SCRIPTPATH=


# varspec                                      cmdspec                        #

LOG=$PWD/tool/sh/log.sh
  true                                         bats test/baseline/3-bats.bats
  set -euo pipefail
   v=4 . tool/sh/env.sh
    . tool/ci/util.sh
        true                                   ci_test test/baseline/1-log.bats
        true                                   ci_test test/unit/std-stack.bats
        true                                   ci_test test/baseline/2-bash.bats
        v=5                                    ci_test test/baseline/3-bats.bats
        true                                   ci_test_negative test/baseline/3-bats-negative.bats
        true                                   ci_test test/baseline/4-mainlibs.bats
        true                                   ci_test test/baseline/4.1-scm-git.bats
        true                                   ci_test test/baseline/realpath.bats
#        true                                   ci_test test/baseline/redo.bats

# FIXME: special syntax for bats; severly misbehaving, killing off the wrong process?
#v=4                                            ; ( bats test/baseline/*.bats )


# varspec                                      cmdspec                        #

# vim:ft=bash:nowrap:cc=47,79:
