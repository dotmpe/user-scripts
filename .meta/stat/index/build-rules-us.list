### Build-rules for components local to +U-s


## Project targets info
# @main: all help @configure @build @test
# @all: @build @test


## Main project targets

# @at.init: @configure :install @check
# @at.check: @lint
# @at.build: @check &context-local &current src-sh manual
# @at.test: %bats-baseline %bats-unit

# XXX:
# @at.env: all @configure @check


## Other alias groups

# @and.ctx-local: &context-local
# @at.lint: *lint
# @at.manual: :manuals

@configure expand ${PROJECT_CACHE:?}/{attributes,params,redo-env}.sh
@configured ifdone @configure


## Symbols for single targets, file groups and mapped sets

&build-rules expand ${PROJECT_CACHE:?}/build-rules.list
&context-local expand ${PROJECT_CACHE:?}/context-local.list
&current alias .meta/cache/ledges.list
*lint expand \&{tags,shellcheck}-lint
&sh-list expand ${PROJECT_CACHE:?}/source-sh.list
&sh-dev-list expand ${PROJECT_CACHE:?}/source-dev-sh.list
&shellcheck-lint expand ${PROJECT_CACHE:?}/lint-shellcheck.list
&source-list expand ${PROJECT_CACHE:?}/source.list
&source-dev-list expand ${PROJECT_CACHE:?}/source-dev.list
&tags-lint expand ${PROJECT_CACHE:?}/lint-tags.list


## Other aliased scripts (defer parts) and function target/pattern handlers

&build-rules:* defer concat-rules
# TODO: install-deps check
# Baseline describes third-party components, dependencies, host.hk
# For host/env prerequisites and checks see init and init-checks targets.
%bats-baseline simpleglob .build/tests/baseline-*.tap test/baseline/%.bats
%bats-unit simpleglob .build/tests/unit-*.tap test/unit/%.bats
# TODO: benchmarks
&context-local:* defer-sequence uconf-deps context-local
#&sh-list:* if :git:index -- eval git ls-files '*.sh' 'sh-*' '*.do' '*.bats'
&shellcheck-lint:* if &sh-dev-list -- defer lint-shellcheck
#&source-list:* if :git:index -- exec git ls-files
&tags-lint:* if &source-dev-list -- defer lint-tags


## Function handlers

:install function
:git:index defer scm-git-index
:lint:shellcheck: defer lint-shellcheck
:lint:tags: defer lint-tags

# TODO: manual
:manuals function - u_s-man
:pack function



# TODO: auto-install/config
./.cllct/src/sh-stats function build_sh_stats u_s-stats
./.meta/cache/build-rules.list defer concat-rules
./.meta/cache/source.list if :git:index -- exec git ls-files
./.meta/cache/source-dev.list function - &source-list
./.meta/cache/source-sh.list if :git:index -- eval git ls-files '*.sh' 'sh-*' '*.do' '*.bats'
./.meta/cache/source-dev-sh.list function - &sh-list


### Special pseudo-target helpers

:if: function -
:if:lines: function -
:if:fun: function -

:if:scr-fun: function -
:if:line-col1: function -


# manual-user-lib simpleglob src/man/man7/User-Script:*.7
# Id: User-scripts/ .meta/stat/index/build-rules-us.list ex:ft=less-txt:
